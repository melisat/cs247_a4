<!DOCTYPE html>
<html lang="en">
  <head>
  	<meta charset="utf-8">
  	<meta name="viewport" content="width=device-width, initial-scale=1">
  	<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css">
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.2.1/jquery.min.js"></script>
    <script type="text/javascript" src="https://www.gstatic.com/charts/loader.js"></script>
    <script type="text/javascript">
        google.charts.load('current', {'packages':['corechart']});
        // google.charts.setOnLoadCallback(drawChart);

        function drawChart(digit) {
        	var base = parseInt($("#base").val());
        	var repr = getRepresentationInBase();
			console.log(repr)
			var numSectors = base - 1;
        	var data = new Array(numSectors).fill(["blah", 1]);
        	var data = google.visualization.arrayToDataTable(
	        	[["c1", "c2"]].concat(data)
			);
			for (var i=0; i<repr.length; i++){
				var options = {
		        	title: repr[i],
		        	colors: new Array(repr[i]).fill('#e0440e').concat(new Array(numSectors-repr[i]).fill('#f6c7b6')),
		        	enableInteractivity: false,
		        	fontSize: 32,
		        	legend: {position: 'none'}
		        };
		        var chart = new google.visualization.PieChart(document.getElementById('piechart'+i));
		        chart.draw(data, options);
			}
        }

        function getRepresentationInBase() {
        	var base = parseInt($("#base").val());
        	var number = parseInt($("#points").val());
			var repr = [];
			console.log("base number", base, number)
			while (number>0) {
				digit=number%base;
				number = Math.floor(number/base);
				console.log(digit, number)
				repr.push(digit)
			}
			//make sure repr is 3 digits long
			while (repr.length<3)
				repr.push(0)
			repr.reverse();
			return repr;
        }

        function updateValue(){
        	$('#pointsText').text($('#points').val());
	        drawChart();
        }

	    $(function () {
			$('#base').on('change', function () {
				var max = Math.pow($(this).val(), 3)-1;
				var currVal = $('#points').val();
				var newVal = Math.min(max, currVal);
		        $('#points').attr({"min": 0, "max": max});
		        $('#points').val(newVal);
		        updateValue();
		    });
		    // setup an event handler to set the text when the range value is dragged (see event for input) or changed (see event for change)
		    $('#points').on('input', updateValue);
		    google.charts.setOnLoadCallback(drawChart);
		});

    </script>
	</head>
	<body>
		<div class="container-fluid">
		    <div class="row">
				Base:<input type="text" id="base" value="10">
			</div>
			<div class="row">
			    <div class="col-sm-4" id="piechart0" style="width: 300px; height: 200px;"></div>
			    <div class="col-sm-4" id="piechart1" style="width: 300px; height: 200px;"></div>
			    <div class="col-sm-4" id="piechart2" style="width: 300px; height: 200px;"></div>
		    </div>
			<div class="row">
				<div class="col-sm-8"> <input type="range" id="points" value="0" min="0" max="999"> </div>
				<div class="col-sm-4"> Points:<label id="pointsText" for="points">0</label> </div>
			</div>
		</div>
  	</body>
</html>
